---
title: "ETN_Gitte_Decat"
output:
  pdf_document: default
  html_document: default
date: "2024-04-23"
---

...

# Background information on the traineeship topic

Biocypher is created to retrieve information about certain interactions and create a knowledge graph. You can retrieve information about gene-gene interactions, protein-protein interactions, gene-disease interactions, metabolic interactions and biological processes. With this information biocypher will create a visual representation of the complexes.  

To be able to create a knowledge graph you need results from a database. Biocypher uses a collection of reusable “adapters” for different sources of biomedical knowledge. Due to the use of adapters, a reproducible knowledge graph can be created and shared for every specific task.  
VIB works with the database IRefIndex and would like to be able to use biocypher to create a knowledge graph. The problem is that there is not a adapter available for the IRefIndex database. In this adapter has to be defined where you can find specific information and what has to happen with that information. In particular they want to get information about the protein-protein interactions when creating the knowledge graph.  

Examples that will be used to create the adapter file are from CROssBAR. CROssBAR is a comprehensive system that integrates large-scale biological/biomedical data from various resources and stores them in a NoSQL database. CROssBAR is enriched with the deep-learning-based prediction of relationships between numerous data entries, which is followed by the rigorous analysis of the enriched data to obtain biologically meaningful modules. These complex sets of entities and relationships are displayed to users via easy-to-interpret, interactive knowledge graphs within an open-access service. CROssBAR knowledge graphs incorporate relevant genes-proteins, molecular interactions, pathways, phenotypes, diseases, as well as known/predicted drugs and bioactive compounds, and they are constructed on-the-fly based on simple non-programmatic user queries. These intensely processed heterogeneous networks are expected to aid systems-level research, especially to infer biological mechanisms in relation to genes, proteins, their ligands, and diseases.

https://biocypher.org/
https://academic.oup.com/nar/article/49/16/e96/6310792?login=true

# TDP

Traineeship documentation plan (TDP)
Student: Gitte Decat 		Traineeship supervisor: Alexander Botzki 
-----------------------------------------------------------------------------------------------------------------------------
Tentative planning: 
During this traineeship I will work with Biocypher. Biocypher is created to retrieve information about certain interactions and create a knowledge graph. You can retrieve information about  gene-gene interactions, protein-protein interactions, gene-disease interactions, metabolic interactions and biological processes. With this information biocypher will create a visual representation of the complexes. 
To be able to create a knowledge graph you need results from a database. Biocypher uses a collection of reusable “adapters” for different sources of biomedical knowledge. Due to the use of adapters a reproducible knowledge graph  can be created and shared for every specific task. 
VIB works with the database IRefIndex and would like to be able to use biocypher to create a knowledge graph. The problem is that there is not a adapter available for the IRefIndex database. In this adapter has to be defined where you can find specific information and what has to happen with that information. In particular they want to get information about the protein-protein interactions when creating the knowledge graph. 
These tasks will be performed during the traineeship from 22/04/2024 till 14/06/2024.
Data management 
All the information that is collected during this traineeship can be found in this github page: https://github.com/GitteDecatBIT/Internship_VIB_2024_GitteDecat.git
In this github repository you can find everything from tutorials, to a workflow and code that is written during the traineeship. The code will be created based on the tutorials that are given by biocypher itself and are find on the website. The github repository that includes the tutorial can be find here: https://github.com/biocypher/project-template.git
Next to the tutorials I will created the adapter file based on the adapter files that can be found in the CROssBARv2 github repository. In this repository, you can find multiple adapter files for various types of information. The adapter files that are created for Biogrid and stringdb fwill be used as an example to create the adapter file for IRefIdex, because there is some similarity between them. This will make it easier to understand the code/logic behind the adapter file. The github repository that includes the CROssBARv2 files can be find here: https://github.com/HUBioDataLab/CROssBARv2.git 


FAIR principles: 
-	Findable:
The data that is used comes from the IRefIndex database. This can be found on https://irefindex.vib.be/wiki/index.php/iRefIndex . In this database has each interactor a unique identifier and has metadata available. Further a key is generated for each protein interaction record and for each participant protein. 
At the end of the traineeship, a zip file will be created of the Internship_VIB_2024_GitteDecat github repository and will be given to VIB. 

-	Accessible: 
The iRefIndex database can be accessed via the following link:   https://irefindex.vib.be/wiki/index.php/iRefIndex . This is open and free and a PSI-MITAB tab-delimited format is used.

-	Interoperable: 
The iRefIndex data is available in PSI-MITAB 2.6 tab-delimited format.

-	Reusable: 
By providing well-structured, well-documented, and openly accessible protein-protein interaction data is IRefIndex reusable and can be integrated with other databases and tools.

Traceability of steps and methods
The ETN with the project steps can be found on the same github page as mentioned before. Everyday the different steps that were performed are documented in the markdown file called ETN_Gitte_Decat.Rmd. 
Version control of code
The status of my github is set on public, so that the github page is available for everyone. At the end of the traineeship, a zip file will be created from the github repository and this will uploaded/send to the traineeship supervisor from VIB and shared with Howest.




# Learning outcome 
Learning outcome (LO)
Student: Gitte Decat 		Traineeship supervisor: Alexander Botzki 
-----------------------------------------------------------------------------------------------------------------------------
Development goal: 
Improve my Python coding skills and understanding the logic behind the codes. Along with understanding how all the scripts used in Biocypher are connected to each other. This also means understanding what every package/library does and where the information comes from. 

Development activity 
I will be working with biocypher and the IRefIndex database during this traineeship. The goal is to provide VIB with an adapter file for IRefIndex that can be used with Biocypher. I have to do a lot of research on how these adapters are formulated. They use the packages pypath and this is new to me, so I have to analyse all the components that can be find in this packages and where to use it/ adapt it for me use. 
At last I should be in contact with a person from Biocypher to let them know that I might have an extra adapter that can be used with Biocypher. These people should than look at my code and say if it is correct and if they even want to include to Biocypher and make it available for other users.

Desired results
At the endof the traineeship I would like to be able to write a Python script (adapter file) that makes it able to use IRefIndex in Biocypher.

Schedule 
These activities will be performed during the traineeship from 22/04/2024 till 14/06/2024.

Necessary support and facilities 
To obtain my goal I will need my traineeship working hours and learning materials such as the IREfIndex database and the Biocypher website that includes: information about the concept, tutorials and the CROssBAR project. 

SMART principles 
Specific: Creating an python script to be able to use IRefIndex together with Biocypher.
Measurable:  At the end of the traineeship I should be able to use the adapter file for IRefindex together with Biocypher and create a knowledge graph. 
Achievable:  With the time and help I can get at VIB I should be able to create the adapter file. 
Relevant: In the context of the traineeship, this learning outcome can be considered relevant.  
Time-bound: This learning outcome should be completed by the end of the traineeship. 



# ETN

## Github
Github page where you can find all the data/info that is discussed in this ETN : https://github.com/GitteDecatBIT/Internship_VIB_2024_GitteDecat.git

### Week 1

#### Monday 22/04/2024
##### Exploring code from Biocypher (adapter)\
First, I looked up some information to get more insight of what  Biocypher exactly does. After this I looked for code that could help me understand what happens when an adapter is created. This code I found on the github page linked on the biocypher website. 
https://github.com/HUBioDataLab/CROssBARv2/tree/main/bccb --> string_adapter.py

##### Creating and updating ETN:\
Start working ETN in Markdown


#### Tuesday 23/04/2024
###### Exploring code from Biocypher (adapter)\
I tried to understand this string_adapter.py code and tried to run it in my virtual studio code. i came accros a few problems that i had to figure out. First of all i had to install Biocypher and create a poetry environment. In this environment i could run the script after i downloaded all the tools/packages that were needed and did not have installed on my system yet. 
github: CROssBARv2/bccb/string_adapter.py

**Installation:** 

- Install pipx  --> sudo dnf install pipx, pipx ensurepath

- Install poetry --> pipx install poetry

- Install biocypher via poetry 
--> create a environment and add biocyher there:poetry new Biocypher_adapter, cd Biocypher_adapter, poetry add biocypher

**Install packages:**

- Install bioregestry --> pip install bioregistry

- Install pypath--> pip install pypath-omnipath
  
Problem: the script did not run completely, when running it it stops after a few step and give the prompt back 

#### Wednesday 24/04/2024
###### Exploring code from Biocypher (tutorial_adapter)\
On the biocypher website you can find a tutorial on how the scripts should work. i performed this tutorial on my system and looked at different scripts that are provided there. i tried to figure out how all the scripts are connected to each other. 
tutorial on github: Internship_VIB_2024_GitteDecat/Biocypher_tutorial/ project-template

###### Creating a workflow (creating a adapter)\
i started creating a workflow based on the tutorial. 

###### Creating github page\
Started to create my github page to collect all my data/information 

####Thursday 25/04/2024
##### Updated ETN\
i updated my ETN for the past days (22-23 april)

##### Creating a workflow (creating a adpater)\
i finished the first version of the workflow based on the tutorial 
workflow on github: Internship_VIB_2024_GitteDecat/Workflow/

##### Added everything to my github\ 
Added all the files i changed to my github 
Added new files to my github 

####Friday 25/04/2024
##### Updated ETN\
iupdated my ETN for the past days

##### IRefIndex code for biocypher\ 
i tried figuring out the code on how biocypher is performed and how the adapter is created, with this information i tried to create the code for the IRefIndex database

##### Run biocypher on Crossbar data\
i tried running biocypher with the crossbar data. i wanted to make sure that the code worked on my virtual studio code but i came across a few problems. 

Problem: 
try running crossbar --> could not import validation_class --> pypandtic and curies where not working together --> updated curies 
did not work

### Week 2

#### Monday 29/04/2024
##### Updated ETN\
i updated my ETN for the week before friday

##### Exploration of the Biogrid code from Crossbar\
I tried figuring out which columns i need to use from the IRefIndex database. I did this based on the code from the Biogrid database. 
github:Internship_VIB_2024_GitteDecat/Biocypher_IRefIndex

#### Tuesday 30/04/2024
##### Updated ETN\
i updated my ETN for the day before 

##### Write TDP\
i started writing my documentation plan for the 8 weeks of the traineeship 
github: Internship_VIB_2024_GitteDecat/ETN/

##### Creating an adapter file for IRefIndex\
I created a script that takes the columns you need as input for the adapter file. i tried adapting the biogrid_adapter file to make it work for irefindex 
github:Internship_VIB_2024_GitteDecat/Biocypher_IRefIndex


#### Wednesday 01/05/2024
##### Labour Day 
Day off

#### Thursday 02/05/2024
##### Submitted TDP (external supervisor)\
i send my  first version of the TDP to my external supervisor of VIB and he gave me some feedback
github: Internship_VIB_2024_GitteDecat/ETN/

##### Creating adapter file for IRefIndex\
I tried figuring out how to map the refseq accession number to the uniprot id ( using biogrid as a example)
github:Internship_VIB_2024_GitteDecat/Biocypher_IRefIndex


#### Firday 03/05/2024
##### Rewrite TDP\
i took the feedback from my external supervisor into account and rewrited my TDP to make it more clear and uploaded it to the one drive 

##### Write LO\ 
i wrote my learning outcome and uploaded it to the one drive 

##### Updated ETN\ 
Updated ETN for the last few days 

##### Upload everything to github\
I uploaded everything to github so that all the information is there for the first time we had to submit the TDP/ETN

##### Creating adapter file for IRefIndex\
I tried figuring out how to map the refseq accession number to the uniprot id (using biogrid as a example)
github:Internship_VIB_2024_GitteDecat/Biocypher_IRefIndex


### Week 3

#### Monday 06/05/2024
##### Create adapter file based on biocypher tutorial\
I tried creating the adapter file based on the tutorial from biocypher, to have a script that works. I try to run the adapter file based on the Crossbar files --> it does not work. Therefore i went back to an more easier example to take as a base. 
i added some parts from the crossbar based file to make it more specific for IRefIndex 
##### Updated ETN\ 
Updated ETN for the this day 

#### Tuesday 07/05/2024
##### Create adapter file based on biocypher tutorial\
I tried including the input from the IRefIndex database. With the structure of the tutorial it is possible to run the scripts and create output. but the output does not overlap with the input from irefindex. In the tutorial they just take random ids, labels and so on... this needs to be adjusted for the irefindex input. 
i also added some logger functions to make it clear for myself what happens as what time. 

#### Wednesday 08/05/2024
##### Create adapter file based on biocypher tutorial\
I was able to include the input from the IRefIndex database. With the structure of the tutorial it is possible to run the scripts and create output. 
this is the output: 2024-05-08 16:59:55,013	INFO	module:_logger
This is BioCypher v0.5.37.
2024-05-08 16:59:55,013	INFO	module:_logger
Logging into `biocypher-log/biocypher-20240508-165955.log`.
2024-05-08 16:59:56,445	INFO	module:CROssBAR_IRefIndex_input
Running input script for IRefIndex
2024-05-08 16:59:56,446	INFO	module:CROssBAR_IRefIndex_input
Downloading interations from IRefIndex
2024-05-08 17:00:02,727	INFO	module:CROssBAR_IRefIndex_input
Getting information for the IRefIndex database: partner_a, partner_b, pumed_ids, method and organism
2024-05-08 17:00:02,837	INFO	module:_get
Loading cache file .cache/cache.json.
2024-05-08 17:00:02,838	INFO	module:_get
Use cached version from .cache/IRefIndex.
2024-05-08 17:00:02,839	INFO	module:create_knowledge_graph_IrefIndex
path: ['.cache/IRefIndex/7227.mitab.08-28-2023.txt.zip', '.cache/IRefIndex/7227.mitab.08-28-2023.txt.zip.unzip']
2024-05-08 17:00:02,842	INFO	module:_ontology
Loading ontologies...
2024-05-08 17:00:02,843	INFO	module:_ontology
Instantiating OntologyAdapter class for https://github.com/biolink/biolink-model/raw/v3.2.1/biolink-model.owl.ttl.
2024-05-08 17:00:07,541	INFO	module:_write
Creating output directory `/home/guest/Github/Internship_VIB_2024_GitteDecat/Create_IRefIndex_adapter_based_on_tutorial/biocypher-out/20240508170002`.
2024-05-08 17:00:07,541	INFO	module:IRefIndex_adapter_03
Generating nodes.
2024-05-08 17:00:08,124	WARNING	module:_deduplicate
Duplicate node type protein found. 
2024-05-08 17:00:08,126	INFO	module:_write
Writing 1 entries to Protein-part000.csv
2024-05-08 17:00:08,126	INFO	module:IRefIndex_adapter_03
Generating edges.
2024-05-08 17:00:08,127	INFO	module:IRefIndex_adapter_03
Generating nodes.
2024-05-08 17:00:08,868	INFO	module:_write
Writing 49 entries to ProteinInteraction-part000.csv
2024-05-08 17:00:08,869	INFO	module:_write
Writing neo4j import call to `/home/guest/Github/Internship_VIB_2024_GitteDecat/Create_IRefIndex_adapter_based_on_tutorial/biocypher-out/20240508170002/neo4j-admin-import-call.sh`.
2024-05-08 17:00:08,869	INFO	module:_ontology
Showing ontology structure based on https://github.com/biolink/biolink-model/raw/v3.2.1/biolink-model.owl.ttl
2024-05-08 17:00:08,870	WARNING	module:_misc
The ontology contains multiple inheritance (one child node has multiple parent nodes). This is not visualized in the following hierarchy tree (the child node is only added once). If you want to browse all relationships of the parsed ontology write a graphml file to disk and view this file.
2024-05-08 17:00:08,870	INFO	module:_ontology

entity
├── association
│   ├── gene to gene association
│   │   └── pairwise gene to gene interaction
│   │       └── pairwise molecular interaction
│   │           └── protein interaction
│   └── protein to disease association
└── named thing
    └── biological entity
        ├── disease or phenotypic feature
        │   └── disease
        └── polypeptide
            └── protein

2024-05-08 17:00:08,870	INFO	module:_core
Duplicate node types encountered (IDs in log): 
    protein

2024-05-08 17:00:08,870	INFO	module:_core
No duplicate edges in input.
2024-05-08 17:00:08,870	INFO	module:_core
No missing labels in input.

problems: 
- only takes 1 id ( first one)
- duplicates ar found 
- still takes random relationship id --> generating edges ( id column in protein-interaction file )
- second node id is not the right one yet 
- label column in protein -part000.csv -> dont know where this comes from 
- example property column in protein interaction file --> dont know what this needs to be / or that it needs to be included 
- 

##### Updated ETN\ 
Updated ETN for the tuesday and wednesday 

#### Thursday 09/05/2024
##### Ascension\
Free day 

#### Friday 10/05/2024\
##### Create adapter file based on biocypher tutorial\
Changed the way the data is downloaded in the adapter file. Use the url in the resource for downloading the data and parse the data in the adapter file other de def get_nodes.



### Week 4

#### Monday 13/05/2024
##### Create adapter file based on biocypher tutorial\
i changed the way that the url is specified. The url is now specified in the biocypher config file. the donwload of the data happens via the resource and the parsing of the file happens in the adapter file. 

integrating the process step of biogrid in the adapter file: 
errors: 
1) File "/home/guest/.cache/pypoetry/virtualenvs/biocypher-project-template-fuLsphMc-py3.11/lib64/python3.11/site-packages/pandas/core/indexes/base.py", line 6251, in _raise_if_missing
    raise KeyError(f"{not_found} not in index")
KeyError: "['uniprot_a', 'uniprot_b'] not in index"

--> uniport_a and uniprot_b are not specified in the input, changed it to partner_a and partner_b

2) File "/home/guest/Github/Internship_VIB_2024_GitteDecat/Create_IRefIndex_adapter_based_on_tutorial/template_package/adapters/IRefIndex_adapter_05.py", line 252, in aggregate_fields
    element = "|".join([str(e) for e in set(element.dropna())])
                                        ^^^^^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'list'  

--> the uniprot column was not correctly parsed, there were some special cases (eg: pubmed:10.1038/nsmb.2049|pubmed:21552260) and these were recognised as a list. --> Adapted the code for parsing that column 

#### Tuesday 14/05/2024
##### Update ETN \
Updated ETN for the day before 
##### Create an overview of the steps that need to happen in the adapter file \
Created an overview for myself of which steps happen in the adapter file while getting the nodes and edges 
##### Create adapter file based on biocypher tutorial\
Created an adapter file that runs fully. the nodes and edges are not correctly specifief yet, because their is no output created.


1) Traceback (most recent call last):
  File "/home/guest/Github/Internship_VIB_2024_GitteDecat/Create_IRefIndex_adapter_based_on_tutorial/create_knowledge_graph_IREFINDEX_05.py", line 73, in <module>
    bc.write_nodes(adapter.get_nodes())
  File "/home/guest/.cache/pypoetry/virtualenvs/biocypher-project-template-fuLsphMc-py3.11/lib/python3.11/site-packages/biocypher/_core.py", line 279, in write_nodes
    nodes = peekable(nodes)
            ^^^^^^^^^^^^^^^
  File "/home/guest/.cache/pypoetry/virtualenvs/biocypher-project-template-fuLsphMc-py3.11/lib/python3.11/site-packages/more_itertools/more.py", line 320, in __init__
    self._it = iter(iterable)
               ^^^^^^^^^^^^^^
TypeError: 'NoneType' object is not iterable

2) ERROR wile writing edge data 

#### Wednesday 15/05/2024
##### Create adapter file based on biocypher tutorial\
Get nodes from the adapter file works + output gets created. The information in the output file is still random. Trying to figure out how to specify the correct information per node

#### Thusday 16/05/2024
##### Create adapter file based on biocypher tutorial\
Trying to figure out how to specify the correct information per node. 
Came accros a problem that the dataframe is too small. Way to many rows are getting removed ??
##### Update ETN \
Updated ETN for the day before 
 